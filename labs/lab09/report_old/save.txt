https://esystem.rudn.ru/pluginfile.php/2843497/mod_resource/content/4/010-selinux.pdf
Основы администрирования операционных систем
Лабораторная работа № 9. Управление SELinux
Отчёт
Сергеев Даниил Олегович
Студент
Направление: Прикладная информатика
Российский университет дружбы народов
01 ноября 2025

# Цель работы

Получить навыки работы с контекстом безопасности и политиками SELinux.

# Задание

- Продемонстрировать навыки по управлению режимами SELinux
- Продемонстрировать навыки по восстановлению контекста безопасности SELinux
- Настроить контекст безопасности для нестандартного расположения файлов веб-службы
- Продемонстрировать навыки работы с переключателями SELinux

# Ход выполнения лабораторной работы

## Управление режимами SELinux

Запустим терминал, получим права администратора (su -) и просмотрим текущую информацию о состоянии SELinux с помощью команды sestatus -v.

Опишем информацию, выведенную на экран:

- SELinux status - статус работы службы SELinux;
- SELinuxfs mount - временная точка монтирования файловой системы SELinux;
- SELinux root directory - расположение файлов конфигурации SELinux;
- Loaded policy name - тип загруженной на данный момент политики SELinux;
- Current mode - текущий режим работы SELinux (Enforcing - блокировка нарушений и их фиксация, permissive - только фиксация нарушений, disabled - SELinux отключен);
- Mode from config file - режим работы, указанный в файле конфигурации /etc/selinux/config;
- Policy MLS status - статус политики MLS;
- Policy deny_unknown status - статус переключателя (флага) deny_unknown в текущей политике;
- Memory protection checking - режим работы защиты памяти;
- Max kernel policy version - максимальная версия политики, поддерживаемая ядром Linux.

![Вывод команды sestatus -v (1)](image/1.PNG){#fig:001 width=90%}

- Process contexts - контексты безопасности процессов из конфига /etc/sestatus.conf.

![Вывод команды sestatus -v (2)](image/2.PNG){#fig:002 width=90%}

- File contexts - контексты безопасности файлов из конфига /etc/sestatus.conf.

![Вывод команды sestatus -v (3)](image/3.PNG){#fig:003 width=90%}

Используя команду getenforce посмотрим, в каком режиме работает SELINUX. На данный момент он находится в режиме Enforcing. Изменим режим работы на Permissive: setenforce 0; И снова проверим режим: на этот раз он изменился на Permissive.

![Изменение режимов SELinux с помощью setenforce](image/4.PNG){#fig:004 width=90%}

В файле /etc/sysconfig/selinux изменим состояние режима на disabled и перезапустим систему.

![Установка режима SELINUX=disabled](image/5.PNG){#fig:005 width=90%}

После перезагрузки запустим терминал под учетной записью root и посмотрим текущий статус. Вывелась строка Disabled - значит SELinux отключен. Попробуем переключить режим работы на enforcing (setenforce 1). Так как SELinux отключен, на экран вывелась ошибка

- setenforce: SELinux is disabled

![Попытка переключение режима SELinux](image/6.PNG){#fig:006 width=90%}

Снова откроем файл /etc/sysconfig/selinux с помощью редактора и установим режим SELINUX=enforcing вручную. Перезагрузим систему.

Во время загрузки выводится предупреждающее сообщение о восстановлении меток SElinux.

![Восстановление меток SELinux после перезапуска](image/7.PNG){#fig:007 width=90%}

После перезапуска снова введем команду sestatus -v, чтобы проверить режим: теперь выводится принудительный режим Enforcing, как и было запланировано.

## Использование restorecon для восстановления контекста безопасности

Просмотрим контекст безопасности файла /etc/hosts. У файла наблюдается отметка контекста: net_conf_t. Скопируем этот файл в домашний каталог и снова проверим контекст. На этот раз установлено: admin_home_t.

![Контекст безопасности файла после копирования](image/8.PNG){#fig:008 width=90%}

Попытаемся перезаписать файл /etc/hosts уже существующим файлом из домашнего каталога и убедимся, что контекст изменился. Так как он действительно изменился, исправим все до прежних настроек, использовав restorecon -v /etc/hosts. Теперь контекст снова равен net_conf_t.

![Восстановление контекста безопасности /etc/hosts](image/9.PNG){#fig:009 width=90%}

Для массового исправления контекста создадим файл \.autorelabel в корневом каталоге и перезапустим систему. Во время перезагрузки нажмем Esc, чтобы проверить загрузочные сообщение. SELinux запустил автоматическую перемаркировку контекста.
 
![Автоматическая перемаркировка SELinux во время перезапуска системы](image/10.PNG){#fig:010 width=90%}

## Настройка контекста безопасности для нестандартного расположения файлов веб-сервера

Проверим установку пакетов httpd и lynx.

![Проверка патеков httpd, lynx](image/11.PNG){#fig:011 width=90%}

Так как они установлены, приступим к следующему заданию.

Создадим новое хранилище для файлов веб-сервера: mkdir /web; Также создадим индекс (в новом каталоге): touch index.html.

В индекс запишем сообщение - Welcome to my web-server.

Откроем файл /etc/httpd/conf/httpd.conf на редактирование. Закомментируем строку DocumentRoot и тег (раздел) Directory, после чего добавим те же строки, заменив пути /var/www/html и /var/www на /web.

![Изменение конфигурации httpd](image/12.PNG){#fig:012 width=90%}

Запустим веб-сервер и службу httpd.

![Запуск httpd](image/13.PNG){#fig:013 width=90%}

Откроем терминал под своей основной учетной записью и обратимся к веб-серверу по адресу localhost в текстовом браузере lynx. Так как контекст безопасности не настроен, выводится веб-страница Red Hat по умолчанию, а не содержимое index.html

![Веб-страница до настройки контекста безопасности](image/14.PNG){#fig:014 width=90%}

В терминале с полномочиями администратора установим новую метку контекста к /web и восстановим контекст безопасности.

![Настройка контекста для веб-сервера](image/15.PNG){#fig:015 width=90%}

Попробуем снова обратится к странице. Она не обновилась, поэтому перезапустим систему чтобы обновить настройки SELinux.

![Обновленная веб-страница](image/16.PNG){#fig:016 width=90%}

Теперь на экране отображена запись "Welcome to my web-server".

## Работа с переключателями SELinux

Снова запустим терминал под учетной записью root и посмотрим список переключателей SELinux для службы ftp. Отметим, что параметр ftpd_anon_write имеет значение off. Просмотрим список переключателей с пояснением для службы ftpd_anon.

![Переключатели для службы ftp, ftpd_anon](image/17.PNG){#fig:017 width=90%}

Вывелся только один переключатель: ftpd_anon_write. Он имеет параметры (off - настройка времени выполнения отключена, off - постоянная настройка отключена) и краткое описание: "Позволить ftpd анонимную запись".

Изменим текущее значение переключателя ftpd_anon_write с off на on: setsebool ftpd_anon_write on; Повторно посмотрим список переключателей (в том числе и с пояснением): getsebool ftpd_anon_write.
 
![Переключатель для службы ftpd_anon после изменения значения](image/18.PNG){#fig:018 width=90%}

Настройка времени выполнения включена, но постоянная настройка по-прежнему отключена.

Изменим постоянное значение переключателя с off на on: setsebool-P ftpd_anon_write on; Посмотрим список: semanage boolean-l | grep ftpd_anon

![Переключатели для службы ftp, ftpd_anon](image/19.PNG){#fig:019 width=90%}

Теперь переключатель имеет состояние (on , on). Это значит, что теперь он включен как постоянная настройка и как настройка времени выполнения.

# Ответы на контрольные вопросы

1. Вы хотите временно поставить SELinux в разрешающем режиме. Какую команду вы используете?

- setenforce 0

2. Вам нужен список всех доступных переключателей SELinux. Какую команду вы используете?

- getsebool -a

3. Каково имя пакета, который требуется установить для получения легко читаемых сообщений журнала SELinux в журнале аудита?

- setroubleshoot

4. Какие команды вам нужно выполнить, чтобы применить тип контекста httpd_sys_content_t к каталогу /web?

- semanage fcontext-a-t httpd_sys_content_t "/web(/.*)?" - добавляет правило в политику
- restorecon -R -v /web - обновляет политику

5. Какой файл вам нужно изменить, если вы хотите полностью отключить SELinux?

- /etc/selinux/config или /etc/sysconfig/selinux

6. Где SELinux регистрирует все свои сообщения?

- /var/log/audit/audit.log

7. Вы не знаете, какие типы контекстов доступны для службы ftp. Какая команда позволяет получить более конкретную информацию?

- seinfo -t | grep ftp

![Вывод seinfo](image/20.PNG){#fig:020 width=90%}

8. Ваш сервис работает не так, как ожидалось, и вы хотите узнать, связано ли это с SELinux или чем-то ещё. Какой самый простой способ узнать?

- Можно перевести SELinux в разрешающий режим (setenforce 0). Таким образом, если проблема связана с SELinux, то сервис перестанет блокироваться политикой, возобновив свою работу. Для дальнейшего анализа можно просмотреть журналы, ведь в режиме permissive SELinux все ещё отправляет логи.

# Вывод

Получить навыки работы с контекстом безопасности и политиками SELinux.

В результате выполнения лабораторной работы я получил навыки работы с контекстом безопасности и политиками SELinux, научился настраивать контекст безопасности для нестандартного расположения файлов веб сервера и переключатели для служб на примере ftp.