https://esystem.rudn.ru/pluginfile.php/2843533/mod_resource/content/4/016-lvm.pdf
Основы администрирования операционных систем
Лабораторная работа № 15. Управление логическими томами
Отчёт
Сергеев Даниил Олегович
Студент
Направление: Прикладная информатика
Российский университет дружбы народов
14 декабря 2025

# Цель работы

Получить навыки управления логическими томами.

# Задание

- Продемонстрировать навыки создания физических томов на LVM;
- Продемонстрировать навыки создания группы томов и логических томов на LVM;
- Продемонстрировать навыки изменения размера логических томов на LVM;
- Выполнить задание для самостоятельной работы;

# Ход выполнения лабораторной работы

## Создание физического тома

Перед выполнением лабораторной работы добавим через меню VirutalBox дополнительный диск ```disk3.vdi``` размером 512 МБ.

Получим полномочия администратора и удалим в файле ```/etc/fstab``` строки автомонтирования из предыдущей лабораторной работы (```/mnt/data``` и ```/mnt/data-ext```) и отмонтируем соответствующие файловые системы.
```bash
su -
vi /etc/fstab
umount /mnt/data
umount /mnt/data-ext
```

Убедимся, что диски не подмонтированы:
```bash
mount | grep mnt
# дополнительно узнаем новые имена дисков
fdisk --list
```

![Проверка разделов и монтирования /mnt](image/1.PNG){#fig:001 width=90%}

С помощью ```fdisk``` сделаем новую разметку для дисков из прошлой лабораторной работы. Сейчас они называются ```/dev/sdb``` и ```/dev/sdd```:
```bash
fdisk /dev/sdb

# В редакторе
# Узнаем текущие партиции
p
# Создадим пустую таблицу DOS-партиции
o
# Проверим изменения
p
# Сохраним изменения
w
```

![Обновление таблицы /dev/sdb (1)](image/1.PNG){#fig:001 width=90%}

![Обновление таблицы /dev/sdb (2)](image/1.PNG){#fig:001 width=90%}

![Обновление таблицы /dev/sdd](image/1.PNG){#fig:001 width=90%}

Запишем изменения в таблицу разделов ядра:
```bash
partprobe /dev/{sdb,sdd}
```

Так как пространство подкачки ```/dev/sdb2``` находится в использовании, отключим его и перезапишем изменения:
```bash
swapoff /dev/sdb2
partprobe /dev/{sdb,sdd}
cat /proc/partitions
```

![Изменение таблицы разделов ядра](image/1.PNG){#fig:001 width=90%}

Будем работать с диском ```/dev/sdc```, подключенным перед лабораторной работой. Создадим новый основной раздел (под номером 1), укажем размер ```+100M``` и тип ```8e - Linux LVM```. Обновим таблицу разделов ядра
```bash
fdisk /dev/sdc
# после изменений
partprobe /dev/sdc1
```

![Создание раздела на /dev/sdc](image/1.PNG){#fig:001 width=90%}

Теперь укажем его как физический том LVM и убедимся что он создан успешно:
```bash
pvcreate /dev/sdc1
# проверка
pvs
```

![Создание физического тома LVM /dev/sdc1](image/1.PNG){#fig:001 width=90%}

## Создание группы томов и логических томов

Создадим группу томов и присвоим её физический том ```/dev/sdc1```, проверим что все создано успешно:
```bash
vgcreate vgdata /dev/sdc1
# проверим наличие группы томов
vgs
# проверим физический том
pvs
```

Создадим логический том LVM с именем ```lvdata```, который будет использовать 50% доступного дискового пространства в группе ```vgdata```, и проверим:
```bash
lvcreate -n lvdata -l 50%FREE vgdata
lvs
```

![Создание группы томов и логического тома](image/1.PNG){#fig:001 width=90%}

Создадим файловую систему поверх логического тома:
```bash
mkfs.ext4 /dev/vgdata/lvdata
```

В конфигурацию автомонтирования добавим строчку:
```bash
/dev/vgdata/lvdata /mnt/data ext4 defaults 1 2
```

Теперь проверим, что файловая система монтируется:
```bash
mount -a
mount | grep /mnt
```

![Создание файловой системы ext4 поверх lvdata](image/1.PNG){#fig:001 width=90%}

![Проверка наличия томов и группы томов](image/1.PNG){#fig:001 width=90%}

## Изменение размера логических томов

С помощью fdisk добавим новый физический раздел ```/dev/sdc2``` размером ```100М```, зададим тип раздела ```8e - Linux LVM```:
```bash
fdisk /dev/sdc
pvcreate /dev/sdc2
```

Расширим ```vgdata```, добавив в него ```/dev/sdc2```:
```bash
vgextend vgdata /dev/sdc2
# Проверка томов
pvs
vgs
lvs
# Проврека файловой системы
df -h | grep lvdata
```

![Расширение группы томов](image/1.PNG){#fig:001 width=90%}

Сейчас ```lvdata``` имеет размер ```40M```. Увеличим его на 50% оставшегося доступного дискового пространства в группе ```vgdata```. Убдеимся, что добавленное пространство стало доступным:
```bash
lvextend -r -l + 50%FREE /dev/vgdata/lvdata
lvs
df -h
```

![Расширение размера логического тома](image/1.PNG){#fig:001 width=90%}

Теперь уменьшим размер ```lvdata``` на ```50M``` и также выполним проверку:
```bash
lvreduce -r -L -50M /dev/vgdata/lvdata
lvs
df -h
```

![Уменьшение размера lvdata, временный umount](image/1.PNG){#fig:001 width=90%}

![Проверка lvdata](image/1.PNG){#fig:001 width=90%}

# Выполнение самостоятельной работы

Будем выполнять работу на диске ```/dev/sdb```. Создадим новый основной раздел размером ```400M``` и типом ```8e - Linux LVM```:
```bash
fdisk /dev/sdb
partprobe /dev/sdb
cat /proc/partitions
```

![Создание нового раздела на /dev/sdb](image/1.PNG){#fig:001 width=90%}

![Обновление таблицы разделов ядра](image/1.PNG){#fig:001 width=90%}

Теперь сделаем раздел физическим томом и создадим группу томов:
```bash
pvcreate /dev/sdb1
vgcreate vg /dev/sdb1
# проверка
vgs
pvs
```

![Создание физического тома из /dev/sdb1](image/1.PNG){#fig:001 width=90%}

Создадим логический том ```lvgroup```. Выделим для него ```200M``` и отформатируем его в файловую систему ```XFS```:
```bash
lvcreate -n lvgroup -L 200M vg
lvs
mkfs.xfs /dev/vg/lvgroup
```

![Создание логического тома lvgroup](image/1.PNG){#fig:001 width=90%}

Подключим автомонтирование. Для этого создадим каталог ```/mnt/groups``` и добавим в конфиг ```/etc/fstab``` строку:
```bash
mkdir -p /mnt/groups
vi /etc/fstab

# в конфиге /etc/fstab
/dev/vg/lvgroup /mnt/groups xfs defaults 1 2
```

![Автомонтирование lvgroup](image/1.PNG){#fig:001 width=90%}

Проверим монтирование:
```bash
mount -a
mount | grep /mnt
```

![Автомонтирование lvgroup](image/1.PNG){#fig:001 width=90%}

Перезагрузим систему.

После перезагрузки проверим что все смонтировалось правильно:
```bash
su -
mount | grep /mnt
lvs
```

![Проверка монтирования после перезагрузки](image/1.PNG){#fig:001 width=90%}

Расширим том ```lvgroup``` на ```150M``` и проверим изменения размера тома и файловой системы:
```bash
lvextend -r -L +150M /dev/vg/lvgroup
lvs
df -h
vgs
```

![Расширение lvgroup](image/1.PNG){#fig:001 width=90%}

![Проверка размера тома и файловой системы](image/1.PNG){#fig:001 width=90%}

# Ответы на контрольные вопросы

1. Какой тип раздела используется в разделе GUID для работы с LVM?

- ```8e - Linux LVM```

2. Какой командой можно создать группу томов с именем vggroup, которая содержит физическое устройство /dev/sdb3 и использует физический экстент 4 MiB?

- ```vgcreate -s 4M vggroup /dev/sdb3```

3. Какая команда показывает краткую сводку физических томов в вашей системе, а также группу томов, к которой они принадлежат?

- ```pvs```

4. Что вам нужно сделать,чтобы добавить весь жёсткий диск /dev/sdd в группу томов группы?

- ```vgextend vggroup /dev/sdd```
- или если группы ещё не существует: ```vgcreate vggroup /dev/sdd```

5. Какая команда позволяет вам создать логический том lvvol1 с размером 6 MiB?

- ```lvcreate -n lvvol1 -L 6M <группа>```

6. Какая команда позволяет вам добавить 100 МБ в логический том lvvol1, если предположить, что дисковое пространство доступно в группе томов?

- ```lvextend -L +100M /dev/vggroup/lvvol1```

7. Каков первый шаг, чтобы добавить ещё 200 МБ дискового пространства в логический том, если требуемое дисковое пространство недоступно в группе томов?

- Необходимо создать новый физический том и добавить его в группу, чтобы она получила больше дискового пространства
- ```pvcreate /dev/sd...```
- ```vgextend vggroup /dev/sd...```

8. Какую опцию нужно использовать с командой lvextend, чтобы также изменить размер файловой системы?

- Нужно добавить опцию ```-r```
- ```lvextend -r -L <размер> <раздел>

9. Как посмотреть, какие логические тома доступны?

- ```lvs```

10. Какую команду нужно использовать для проверки целостности файловой системы на /dev/vgdata/lvdata?

- ```fsck /dev/vgdata/lvdata```

# Вывод

В результате выполнения лабораторной работы я узнал как управлять логическими томами и создавать их. Получил навыки по расширению и сокращению размеров логических томов и по объединению томов в группы.